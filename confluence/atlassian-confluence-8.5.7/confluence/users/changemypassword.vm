<html>
	<head>
		<title>$htmlUtil.htmlEncode($pageTitle)</title>
        #requireResource("confluence.web.resources:aui-forms")
</head>

    #applyDecorator("root")
        #decoratorParam("context" "profile")
        #decoratorParam("mode"  "settings")
        #decoratorParam("helper" $action.helper)

        <body>
        #if ($settingsManager.getGlobalSettings().isExternalUserManagement())
            $action.getText("cannot.change.password.users.outside")
        #elseif(!$userAccessor.isReadOnly($remoteUser))
            #applyDecorator("form-aui")
                #decoratorParam("formName" "changepassword")
                #decoratorParam("submitAction"  "dochangemypassword.action")
                #decoratorParam("editAction" "changemypassword.action")
                #decoratorParam("editMode" "$editMode")
                #decoratorParam("saveValue" "Save")

                <h2>$action.getText("change.password")</h2>
                <fieldset>
                    #assistiveLegend("accessibility.profile.password")
                    #set ($templateParameters = {
                        "id": "currentPassword",
                        "labelContent": "$i18n.getText('cur.pass.name')",
                        "name": "currentPassword",
                        "isRequired": $action.getText('required.field'),
                        "errorTexts": $!fieldErrors.get('currentPassword')})
                    $soyTemplateRendererHelper.getRenderedTemplateHtml("com.atlassian.auiplugin:aui-experimental-soy-templates", "aui.form.passwordField.soy", $templateParameters)
                    #set ($templateParameters = {
                        "id": "newPassword",
                        "labelContent": "$i18n.getText('new.pass.name')",
                        "name": "newPassword",
                        "isRequired": $action.getText('required.field'),
                        "errorTexts": $!fieldErrors.get('newPassword')})
                    $soyTemplateRendererHelper.getRenderedTemplateHtml("com.atlassian.auiplugin:aui-experimental-soy-templates", "aui.form.passwordField.soy", $templateParameters)
                    #set ($templateParameters = {
                        "id": "newPasswordConfirmation",
                        "labelContent": "$i18n.getText('new.pass.confirm.name')",
                        "name": "newPasswordConfirmation",
                        "isRequired": $action.getText('required.field'),
                        "errorTexts": $!fieldErrors.get('newPasswordConfirmation')})
                    $soyTemplateRendererHelper.getRenderedTemplateHtml("com.atlassian.auiplugin:aui-experimental-soy-templates", "aui.form.passwordField.soy", $templateParameters)
                </fieldset>
                #form_xsrfToken()
                #ssubmit("theme='aui'")
            #end
        #end
        </body>

    #end
</html>
