define("confluence/avataror",["jquery"],function(b){return function(){b(".avataror").each(function(){var d=b(this),e=b("img",this).attr("src");d.css({"border-radius":"10px"});d.html("<p>Loadingâ€¦</p>");var a={previewSize:64};a.preview=b("<div></div>").css({border:"solid 1px #000","float":"left",height:"64px",overflow:"hidden",width:"64px",position:"relative",top:"-9999em",left:"-9999em"});d.append(a.preview);a.img=b('<img src="'+e+'" alt="Avatar Source"/>');a.img.load(function(){a.image=b("<div></div>").css({background:"url('"+
e+"') no-repeat",clear:"left",position:"relative"});a.marker=b("<div></div>").css({cursor:"move",position:"relative"});a.dash=b("<div></div>");a.shadow=b("<div></div>");a.dash.add(a.shadow).css({cursor:"move",opacity:0.5,left:0,top:0,position:"absolute"});a.image.append(a.shadow).append(a.dash).append(a.marker);d.append(a.image);a.marker.html("<div></div><div></div><div></div><div></div>");b("div",a.marker).each(function(f){var c=b(this);c.css({background:"#000",border:"solid 1px #fff",width:"10px",
height:"10px",position:"absolute","font-size":"1px"});c.css(["left","right","right","left"][f],"-6px");c.css(["top","top","bottom","bottom"][f],"-6px");c.css("cursor",["nw-resize","ne-resize","se-resize","sw-resize"][f]);c.mousedown(function(b){b.preventDefault();b.stopPropagation();a.dragging={x:b.pageX,y:b.pageY,ax:a.x,ay:a.y,w:a.width,h:a.height,i:f+1};a.shadow.hide()})});a.marker.add(a.image).mousedown(function(b){b.preventDefault();a.dragging={x:b.pageX,y:b.pageY,ax:a.x,ay:a.y,w:a.width,h:a.height};
a.shadow.hide()}).mousemove(function(b){if(a.dragging){var c=b.pageX-a.dragging.x,d=b.pageY-a.dragging.y;a.x=a.dragging.ax+c;a.y=a.dragging.ay+d;console.log([a.x,a.width,a.imgwidth]);console.log([a.y,a.height,a.imgheight]);a.x+a.width>a.imgwidth&&(a.x=a.imgwidth-a.width);a.y+a.height>a.imgheight&&(a.y=a.imgheight-a.height);0>a.x&&(a.x=0);0>a.y&&(a.y=0);var b=[0,1,-1,-1,1],e=[0,1,1,-1,-1];if(a.dragging.i&&(c=Math.abs(c)<Math.abs(d)?e[a.dragging.i]*d:b[a.dragging.i]*c,a.width=a.height=a.dragging.w-
c,20>a.width&&(a.width=a.height=20),a.x=a.dragging.ax+(a.dragging.w-a.width)*(1+b[a.dragging.i])/2,a.y=a.dragging.ay+(a.dragging.h-a.height)*(1+e[a.dragging.i])/2,a.x+a.width>a.imgwidth&&(a.width=a.height=a.imgwidth-a.x),a.y+a.height>a.imgheight))a.width=a.height=a.imgheight-a.y;a.setMarker()}}).mouseup(function(){b("#avatar-offsetX").val(a.x);b("#avatar-offsetY").val(a.y);b("#avatar-width").val(a.width);a.dragging=null;a.shadow.show()});a.imgwidth=a.img.width();a.imgheight=a.img.height();a.x=1*b("#avatar-offsetX").val();
a.y=1*b("#avatar-offsetY").val();a.width=1*b("#avatar-width").val();a.height=a.width;a.image.css({width:a.imgwidth+"px",height:a.imgheight+"px"});a.setMarker();d.css({width:a.imgwidth+"px"});a.preview.css({margin:"0 0 10px "+Math.round(a.imgwidth/2-a.previewSize/2)+"px",position:"static"});b("p",d).remove()});a.preview.append(a.img);a.setMarker=function(){this.marker.css("border","dashed 1px #fff");this.dash.css("border","solid 1px #000");this.shadow.css("border","solid 1px #000");this.marker.add(this.dash).css("left",
this.x-1+"px");this.marker.add(this.dash).css("top",this.y-1+"px");this.shadow.css("border-left-width",this.x+"px");this.shadow.css("border-right-width",this.imgwidth-this.x-this.width+"px");this.shadow.css("border-top-width",this.y+"px");this.shadow.css("border-bottom-width",this.imgheight-this.y-this.height+"px");this.shadow.css("width",this.width+"px");this.shadow.css("height",this.height+"px");this.marker.add(this.dash).css("width",this.width+"px");this.marker.add(this.dash).css("height",this.height+
"px");this.img.attr("width",this.imgwidth*this.previewSize/this.width);this.img.attr("height",this.imgheight*this.previewSize/this.height);this.img.css("margin-left","-"+this.x*this.previewSize/this.width+"px");this.img.css("margin-top","-"+this.y*this.previewSize/this.height+"px");this.preview.select()}})}});require("confluence/module-exporter").safeRequire("confluence/avataror",function(b){require("ajs").toInit(b)});