define("confluence/analytics-support","jquery ajs confluence/meta window document confluence/api/url".split(" "),function(j,o,l,k,m,h){var b=Object.create(null),n;b.setAnalyticsSource=function(a,d){if(typeof n==="undefined"){var c=j._data(k,"events");n=c&&c.analytics&&c.analytics.length>0}n&&a.attr("href",function(a,c){var b=encodeURIComponent(d),g=h.parseUrl(c);g.size!==0&&g.get("queryParams").set("src",[b]);return h.formatUrl(g)})};b.srcRemovedUrl=function(a){a=h.parseUrl(a);a.get("queryParams").delete("src");
for(var d=Array.from(a.get("queryParams").keys()),c=0;c<d.length;c++){var b=d[c],f=b.split(".");f.length===3&&f[0]==="src"&&a.get("queryParams").delete(b);b==="jwt"&&a.get("queryParams").delete(b)}return h.formatUrl(a)};b.srcParamValues=function(a){return(a=h.parseUrl(a).get("queryParams"))&&a.get("src")?a.get("src"):[]};b.srcAttrParamValues=function(a){for(var a=h.parseUrl(a).get("queryParams"),b=Object.create(null),c=Array.from(a.keys()),e=0;e<c.length;e++){var f=c[e],i=f.split(".");if(i.length===
3&&i[0]==="src"){var g=i[1],i=i[2];b[g]=b[g]||Object.create(null);b[g][i]=decodeURIComponent(a.get(f)[0])}}return b};b.extractAnalyticsData=function(a){for(var d=[],c=b.srcParamValues(a),a=b.srcAttrParamValues(a),e=0;e<c.length;e++){var f=c[e];d.push({src:f,attr:a[f]||{}})}return d};b.publish=function(a,b){o.trigger("analytics",{name:a,data:b||{}})};b.init=function(){var a=b.extractAnalyticsData(m.URL),d={userKey:l.get("remote-user-key"),pageID:l.get("page-id"),draftID:l.get("draft-id")};if(a.length>
0){for(var c=0;c<a.length;c++){var e=a[c],f=j.extend({},d,e.attr);b.publish("confluence.viewpage.src."+e.src,f)}if(k.history&&k.history.replaceState){a=b.srcRemovedUrl(m.URL);m.URL!==a&&k.history.replaceState(null,"",a)}}else b.publish("confluence.viewpage.src.empty",d)};return b});require("confluence/module-exporter").exportModuleAsGlobal("confluence/analytics-support","AJS.Confluence.Analytics",function(j){require("ajs").toInit(j.init)});