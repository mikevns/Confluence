define("confluence/mailserver",["jquery","ajs","confluence/message-controller","wrm/context-path"],function(a,d,k,i){var q=i()+"/admin/mail/mailserver-testconnection.action",l={pop3:110,pop3s:995,imap:143,imaps:993},p={init:function(){var g=a("#authorization"),c="BasicAuth"===g.val(),h=a("#password"),e=a("#token"),f=void 0!==e.val()&&""!==e.val(),b=a("input[name='confirm']"),m=a("input[name='authorize']"),j=a("input[name='testConnection']"),n=a("#port"),o=a("select[name='protocol']"),i="smtp"===a("input[name='protocol']").val();
j.click(function(b){var c={token:e.val(),protocol:o.val(),hostname:a("input[name='hostname']").val(),port:n.val(),userName:a("input[name='userName']").val(),authorization:g.val()};b.preventDefault();b.stopImmediatePropagation();p.postTestConnectionRequest(c);return!1});o.change(function(){var b=a(this).val();l.hasOwnProperty(b)?n.val(l[b]):k.showError(d.I18n.getText("mail.server.protocol.unsupported",b),k.Location.FLAG)});g.change(function(c){var d="BasicAuth"===a(this).val();c.preventDefault();h.parent().css("display",
d?"inline-block":"none");h.val("");b.prop("disabled",!d&&""===e.val());m.prop("disabled",d);j.prop("disabled",d||!f)});!c&&!i&&h.parent().css("display","none");(c||f)&&b.prop("disabled",!1);m.prop("disabled",c);j.prop("disabled",c||!f)},postTestConnectionRequest:function(g){var c=a("input[name='testConnection']"),h=a("#action-messages"),e=a("#admin-body-content"),f={closeable:!1};a(".aui-message").remove();c.prop("disabled",!0);a("#testConnection-spinner").spin();return a.post(q,g,"json").done(function(b){"OK"===
b.status?h.append(d.messages.success(a.extend({body:b.message},f))):e.prepend(d.messages.error(a.extend({body:b.message},f)))}).fail(function(){var b=d.I18n.getText("setup.mail.server.test.connection.error");e.prepend(d.messages.error(a.extend({body:b},f)))}).always(function(){a("#testConnection-spinner").spinStop();c.prop("disabled",!1)})}};return p});require("confluence/module-exporter").safeRequire("confluence/mailserver",function(a){require("ajs").toInit(a.init)});