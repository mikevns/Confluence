define("confluence/watches",["ajs","jquery"],function(a,b){var d=[],i=function(f,j){f.attr("data-watching-bound")||(f.delegate(".icon-start-watching, .icon-stop-watching, .link-start-watching, .link-stop-watching","click",function(h){var c=b(h.target),e,h=f.attr("data-entity-type");e=j&&j.getEntityId&&"function"===typeof j.getEntityId?j.getEntityId(c):f.attr("data-entity-id");if(d[e])a.log("Already busy toggling favourite for "+h+" '"+e+"'. Ignoring request.");else{d[e]=!0;var g=c.hasClass("icon-stop-watching")||
c.hasClass("link-stop-watching"),i=c.hasClass("icon-stop-watching"),k=c.parent().find(".icon-wait"),l,m;"page"==h&&(l=a.contextPath()+"/users/"+(g?"removepagenotificationajax.action":"addpagenotificationajax.action"),m={pageId:e});"space"==h&&(l=a.contextPath()+"/users/"+(g?"removespacenotificationajax.action":"addspacenotificationajax.action"),m={spaceKey:e});c.addClass("hidden");k.removeClass("hidden");a.safe.ajax({url:l,type:"POST",data:m,success:function(b){a.log(b);k.addClass("hidden");i?c.parent().find(g?
".icon-start-watching":".icon-stop-watching").removeClass("hidden"):c.parent().find(g?".link-start-watching":".link-stop-watching").removeClass("hidden");delete d[e]},error:function(b,f){k.addClass("hidden");i?c.parent().find(g?".icon-start-watching":".icon-stop-watching").removeClass("hidden"):c.parent().find(g?".link-start-watching":".link-stop-watching").removeClass("hidden");a.log("Error Toggling Watching: "+f);delete d[e]}});return!1}}),f.attr("data-watching-bound",!0))};return{binder:function(){b(".entity-watching").each(function(){b(this).attr("data-watching-bound")||
i(b(this),{})})},plugin:function(a){b(this).each(function(){var d=b(this);i(d,a)})}}});require("confluence/module-exporter").safeRequire("confluence/watches",function(a){var b=require("ajs"),d=require("jquery");b.Confluence.Binder.watching=a.binder;d.fn.watching=a.plugin});