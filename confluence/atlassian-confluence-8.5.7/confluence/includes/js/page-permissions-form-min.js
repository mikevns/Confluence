define("confluence/page-permissions-form",["jquery","ajs","document","confluence/aui-overrides"],function(d,j,l,k){return function(f){var e={handleNonExistentEntityNames:function(a){a&&a.length&&(a=a.join(", "),this.showErrorMessage(j.I18n.getText("page.perms.error.invalid.entity.names")+" "+a))},showErrorMessage:function(a){j.messages.warning("#page-permissions-editor-form",{title:a,id:"page-permissions-error-div",insert:"prepend"});var a=d("#page-permissions-editor-form"),b=d("#page-permissions-tables"),
c=423-a.outerHeight(!0)-35;b.css("height",c);a.find(".icon-close").on("click",function(){b.height(286)})},isDuplicateEntityForType:function(a,b){return 0<d("#page-permissions-table ."+a.type+"-permission."+b+"-permission-row .permission-entity-name").filter(function(){return d(this).text()===a.name}).length},resetValidationErrors:function(){d("#page-permissions-tables").height(286);d("#page-permissions-error-div").remove()}},g,c=d("#page-permissions-names-input"),h=d("#page-permissions-names-hidden"),
m=c.val();c.keypress(function(a){return 13===a.keyCode?(i(),c.focus(),!1):!0});c.bind("selected.autocomplete-user-or-group",function(a,b){h.val(unescape(b.content.key.replace(/\+/g," ")));c.val("");i(b.content.type);a.preventDefault()});c.focus(function(){var a=c.next(".aui-dd-parent");if(a.length){a.show();var b=c.offset().left;a.offset().left!=b&&(a.css("margin-left",0),b-=a.offset().left,a.css("margin-left",b+"px"));b=c.offset().top+c.outerHeight();a.offset().top!=b&&(a.css("margin-top",0),b-=
a.offset().top,a.css("margin-top",b+"px"));a.css({width:c.outerWidth()});a.hide()}});g={getValue:function(){var a=h.val();a?h.val(""):(a=c.val(),a==m&&(a=""));return a},removeFromNameInput:function(a){if(a){var b=c.val();if(b){for(var b=b.split(","),e=0;e<b.length;e++)b[e]=d.trim(b[e]);b=d.grep(b,function(b){return""!=b&&b!=a});b.length?c.val(b.join(", ")):l.activeElement==c[0]&&c.val("")}}}};var i=function(a){e.resetValidationErrors();f.table.clearHighlight();var b=g.getValue();b&&f.addNames(b,a)};
d("#page-permissions-choose-me").click(function(a){e.resetValidationErrors();f.addNames(d(this).find(".remote-user-name").text());a.stopPropagation();return!1});d("#permissions-error-div-close").click(function(a){e.resetValidationErrors();a.stopPropagation();return!1});d("#add-typed-names").click(function(){i()});return{validator:e,nameField:g,setVisible:function(a){k.setVisible("#page-permissions-editor-form",a);k.setVisible(".remove-permission-link",a)},isShowing:function(){return!d("#page-permissions-editor-form").hasClass("hidden")},
getPermissionType:function(){return d("#restrictViewRadio:checked").length?"view":"edit"}}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence/page-permissions-form","AJS.PagePermissions.Controls");