define("confluence/admin-indexing",["jquery","window","confluence/api/ajax","confluence/api/constants"],function(a,m,o,n){var i=function(f,e,g){var g=a.extend({height:"1em",showPercentage:!0},g),c=f.attr("id")+"-incomplete-bar",b=f.attr("id")+"-complete-bar",h=f.attr("id")+"-percent-complete-text",d;0===a("#"+c).length?(d=a(document.createElement("div")),d.attr("id",c),d.css({width:"90%",border:"solid 1px #ccc","float":"left","margin-right":"0.5em"}),d.addClass("progress-background-color"),c=a(document.createElement("div")),
c.attr("id",b),c.addClass("progress-fill-color"),c.css({height:g.height,width:e+"%"}),b=a(document.createElement("span")),b.attr("id",h),b.addClass("percent-complete-text"),b.html(e+"%"),d.append(c),f.append(d),g.showPercentage&&f.append(b)):(a("#"+b).css("width",e+"%"),a("#"+h).html(e+"%"))};return function(){function f(){var b;c.prop("disabled",!0);b=m.setInterval(function(){a.getJSON(n.CONTEXT_PATH+"/json/reindextaskprogress.action",function(a){i(e,a.percentageComplete);p.text(a.count+" / "+a.total);
d.show();h.html(a.compactElapsedTime);100===a.percentageComplete&&(c.prop("disabled",!1),j.show(),k.hide(),l.hide(),m.clearInterval(b))})},1E3)}var e=a("#search-index-task-progress-container"),g=0<a("#reindex-task-in-progress").length,c=a("#build-search-index-button"),b=0<a("#search-index-exists").length,h=a("#search-index-elapsed-time"),d=a("#search-index-elapsed-time-container"),k=a("#search-index-error-status"),j=a("#search-index-success-status"),l=a("#search-index-inprogress-status"),p=a(".indexing-status");
c.click(function(){o.ajax({url:n.CONTEXT_PATH+"/admin/reindex.action",type:"POST",dataType:"json",data:{},success:function(){i(e,0);d.hide();f()}});return!1});(!b||""===h.html())&&d.hide();i(e,0);g&&f();b&&!g&&i(e,100);g?(l.show(),k.hide(),j.hide()):(b?(j.show(),k.hide()):(k.show(),j.hide()),l.hide())}});require("confluence/module-exporter").safeRequire("confluence/admin-indexing",function(a){require("ajs").toInit(a)});