define("confluence/create-space","ajs jquery confluence/templates window underscore confluence/api/constants confluence/api/logger confluence/meta confluence/api/event".split(" "),function(i,d,v,p,q,r,s,t,j){return function(){function l(a){a?m.removeAttr("disabled"):m.attr("disabled","disabled");o=a}function n(a){l(false);var c=a.attr("name"),b=a.siblings(".error");g[c]=true;var e=u[c]();e.done(function(){delete g[c];b.text("").addClass("hidden")});e.fail(function(a){b.text(a).removeClass("hidden")});
e.always(function(){l(d.isEmptyObject(g));a.attr("data-validated-value",a.val())});return e}var b,h,m,o=false,f,u={key:function(){var a=d.Deferred(),c=d.trim(b.val());if(!c){a.reject(i.I18n.getText("space.key.empty"));return a}if(f){s.log("Aborting previous space key validation request.");f.abort()}f=d.getJSON(r.CONTEXT_PATH+"/ajax/spaceavailable.action",{key:c}).done(function(b){!b.available&&b.message?a.reject(b.message):a.resolve();f=false});return a.promise()},name:function(){var a=d.Deferred();
d.trim(h.val())?a.resolve():a.reject(i.I18n.getText("space.name.empty"));return a.promise()}},g={};j.bind("ready-for-create-space-form-init",function(a,c){m=c.find("input[type=submit]");var f=function(){var a=d(this),b=a.val();typeof a.data("originalVal")==="undefined"&&a.data("originalVal","");if(a.data("originalVal")!==b){a.data("originalVal",b);n(a)}},e=c.find("#space-url-example"),g=t.get("base-url")+"/display/",j="<"+i.I18n.getText("space.create.form.key.placeholder")+">",k=false;l(false);e.text(g+
j);b=c.find("input[name='key']").first();h=c.find("input[name='name']").first();b.parent().find(".error");h.parent().find(".error");b.generateFrom(h,{uppercase:false,maxNameLength:255,maxKeyLength:255,timeoutMS:100,validationCallback:function(){b.keyup()}});b.keyup(q.debounce(f,500));h.keyup(f);b.keyup(function(){var a=b.val(),a=a||j;e.text(g+a)});b.focus(function(){var a=b[0];if(a.setSelectionRange){var c=b.val().length;a.setSelectionRange(0,c)}else if(a.createTextRange){a=a.createTextRange();a.execCommand("SelectAll");
a.select()}});c.find("#permission-private").change(function(){d("#permissions-group").toggleClass("locked")});c.submit(function(a){if(!k){a.preventDefault();p.setTimeout(function(){var a=n(b),e=n(h);d.when({},a,e).then(function(){if(o){k=true;c.submit()}})},101)}})});var k=d("#create-space-form:not(.noautobind)");k.length&&j.trigger("ready-for-create-space-form-init",[k])}});require("confluence/module-exporter").safeRequire("confluence/create-space",function(i){require("ajs").toInit(i)});