define("confluence/attachment-uploader",["ajs","jquery","confluence/aui-overrides"],function(b,e,h){return function(f,i){var a,g,c,d;a=e.extend({getForm:function(){return e("form",f.baseElement)},getUploadingMessageElement:function(){return e(".upload-in-progress",f.baseElement)},pack:function(){},displayErrors:function(a){d.displayMessages(a);this.pack()},clearErrors:function(){d.clearMessages();this.pack()},setUploadInProgress:function(a,b){var c=this.getUploadingMessageElement();a&&c.html(b||this.getDefaultUploadingMessage());
h.setVisible(c,a);h.setVisible(this.getForm(),!a)},onUploadSuccess:function(){},getMessageHandler:function(){d||(d=b.MessageHandler({baseElement:e(".warning",f.baseElement)}));return d},getDefaultErrorMessage:function(){return b.I18n.getText("attachment.uploader.error")},getDefaultUploadingMessage:function(){return b.I18n.getText("attachment.uploader.uploading")},getContentId:function(){return b.Meta.get("attachment-source-content-id")}},i&&i(f));g=a.getMessageHandler();c=a.getForm();b.Meta.getBoolean("can-attach-files")?
(c.ajaxForm({dataType:"json",timeout:36E5,data:{contentId:a.getContentId(),responseFormat:"html"},resetForm:!0,beforeSubmit:function(){a.setUploadInProgress(!0);g.clearMessages()},success:function(b){a.setUploadInProgress(!1);if(!g.handleResponseErrors(b,a.getDefaultErrorMessage()))a.onUploadSuccess(b.attachmentsAdded||[])},error:function(c){a.setUploadInProgress(!1);g.displayMessages(a.getDefaultErrorMessage());b.logError("Response from server was: "+c.responseText)}}),c.find("input:file").change(function(){c.submit()})):
c.remove();return a}});require("confluence/module-exporter").exportModuleAsGlobal("confluence/attachment-uploader","Confluence.AttachmentUploader");