define("confluence/page-move-dialog","ajs confluence/templates confluence/legacy confluence/meta window jquery confluence/breadcrumbs wrm wrm/context-path confluence/message-controller confluence/form-state-control confluence/api/ajax confluence/api/event".split(" "),function(d,f,k,e,J,a,B,K,u,C,m,D,p){return function(){function E(){var b=a("#move-page-dialog");b.find(".button-spinner").each(function(b,c){a(c).spin()});m.disableElement(b.find(".move-button")[0])}function z(){var b=a("#move-page-dialog");
b.find(".button-spinner").each(function(b,c){a(c).spinStop()});m.enableElement(b.find(".move-button")[0])}function L(b,e,c,f,h,j,v){function l(a){v(a);m.enableElement([r,s,g,q,k]);z()}function F(a){if(a.messages&&a.messages.length)try{return a.messages[a.messages.length-1].translation}catch(b){}return""}function i(){a.ajax({url:u()+M.replace("<taskId>",n)}).fail(function(){clearTimeout(t);l()}).done(function(b){var c=Math.round(b.elapsedTime/1E3)+"s";a("#move-page-dialog .status").html(c);if(b.successful)if(+b.percentageComplete>=
100){clearTimeout(t);b.successful?J.location.href=u()+"/pages/viewpage.action?pageId="+w.id+"&moved=true":l(F(b))}else t=setTimeout(i,p++<5?N:O);else{clearTimeout(t);l(F(b))}})}var b=a("#move-page-dialog"),r=b.find(".move-button")[0],s=b.find("button.reorder-button")[0],g=b.find(".button-panel-cancel-link")[0],q=b.find(".dialog-back-link")[0],k=b.find("#reorderCheck")[0],t,p=0,n,w;a("#move-errors").remove();E();m.disableElement(r);a("#createpageform").length>0?x||m.disableElement([s,g,q,k]):m.disableElement([s,
g,q,k]);D.ajax({url:u()+"/pages/movepage.action",type:"POST",dataType:"json",timeout:18E4,data:new G(e,f,h,j,H.ASYNC),error:function(a){l(C.parseError(a,d.I18n.getText("move.page.dialog.move.failed")))},success:function(a){var b=[].concat(a.validationErrors||[]).concat(a.actionErrors||[]).concat(a.errorMessage||[]);if(b.length>0)l(b);else{n=a.longTaskId;w=a.page;i()}}})}var H={LEGACY:"LEGACY",ASYNC:"ASYNC"},x=d.DarkFeatures.isEnabled("editor.ajax.save")&&!d.DarkFeatures.isEnabled("editor.ajax.save.disable"),
M="/rest/api/longtask/<taskId>",O=500,N=100,A=function(b){function y(b){var c=a("#move-errors");c.length>0&&c.remove();var c=a(f.MovePage.errorMessage()),d=g.find(".browse-controls:visible");if(d.length)d.append(c);else{d=g.find(".dialog-panel-body:visible");d.prepend(c)}if(!b||b.length===0)a(s).prop("disabled",false);else{b=a.isArray(b)&&b.length>1?f.MovePage.errorList({errors:b}):b;b=aui.message.error({content:b});c.html(b);c.removeClass("hidden")}}var c=e.get("page-title"),b=a.extend({spaceKey:e.get("space-key"),
spaceName:e.get("space-name"),pageTitle:c,parentPageTitle:e.get("parent-page-title"),title:d.I18n.getText("move.page.dialog.title.view",c),buttonName:d.I18n.getText("move.name"),openedPanel:d.I18n.getText("move.page.dialog.panel.location"),moveHandler:function(a){d.debug("No move handler defined. Closing dialog.");a.remove()},cancelHandler:function(a){a.remove();return false}},b),o=b.spaceKey,h=b.spaceName,j=b.parentPageTitle,v="",l="",p=function(a,b){v=a;l=b},c=d.ConfluenceDialog({width:840,height:590,
id:"move-page-dialog"}),i={spaceKey:o,spaceName:h,parentPageTitle:j,canMoveBetweenSpaces:e.get("page-id")==="0"||e.getBoolean("can-remove-page"),canMoveHierarchyBetweenSpaces:e.get("page-id")==="0"||e.getBoolean("can-remove-page-hierarchy")};c.addHeader(b.title);c.addPanel(d.I18n.getText("move.page.dialog.panel.location"),f.MovePage.movePageAdvancedPanel(i),"location-panel","location-panel-id");c.addPanel(d.I18n.getText("move.page.dialog.search.title"),f.MovePage.movePageSearchPanel(i),"search-panel",
"search-panel-id");c.addPanel(d.I18n.getText("move.page.dialog.history.title"),f.MovePage.historyPanel({pageTitle:e.get("page-title")}),"history-panel","history-panel-id");c.addPanel(d.I18n.getText("move.page.dialog.browse.title"),f.MovePage.browsePanel({pageTitle:e.get("page-title")}),"browse-panel","browse-panel-id");c.get('#"'+d.I18n.getText("move.page.dialog.panel.location")+'"')[0].onselect=function(){a("#new-space-key").val(o);a("#new-space").val(h);a("#new-parent-page").val(j).select()};c.get('#"'+
d.I18n.getText("move.page.dialog.search.title")+'"')[0].onselect=function(){var b=a("#move-page-dialog");b.find(".search-panel .search-results .selected").removeClass("selected");b.find("input.search-query").focus()};c.get('#"'+d.I18n.getText("move.page.dialog.history.title")+'"')[0].onselect=function(){a(".history-panel",g).movePageHistory(n)};c.get('#"'+d.I18n.getText("move.page.dialog.browse.title")+'"')[0].onselect=function(){d.debug("browse: "+[o,h,j].join());a(".browse-panel",g).movePageBrowse(n,
o,h,j,w,b.pageTitle)};var r=function(c){var i=a("#new-space:visible").val(),e=a("#new-space-key").val(),g=a("#new-parent-page:visible").val();if(i&&(i!==h||e!==o||g!==j))k.Dialogs.Breadcrumbs.defaultGetBreadcrumbs({spaceKey:e,pageTitle:g},function(){k.PageLocation.set({spaceKey:e,spaceName:i,parentPageTitle:g});b.moveHandler(c,e,i,g,v,l,y)},function(b){a("#new-parent-breadcrumbs").html(f.MovePage.breadcrumbError());b.status===404&&n.error(d.I18n.getText("move.page.dialog.location.not.found"))});else{k.PageLocation.set({spaceKey:o,
spaceName:h,parentPageTitle:j});b.moveHandler(c,o,h,j,v,l,y)}};c.addButton(b.buttonName,function(c){if(a("#createpageform").length>0&&d.DarkFeatures.isEnabled("editor.ajax.save")&&!d.DarkFeatures.isEnabled("editor.ajax.save.disable"))r(c);else if(a("#reorderCheck")[0].checked){c.nextPage();c=a("#move-page-dialog");a(".ordering-panel",c).movePageOrdering(o,j,b.pageTitle,p)}else r(c)},"move-button aui-button aui-button-primary");a(".button-panel-button.move-button").attr("id","move-button");c.addCancel(d.I18n.getText("cancel.name"),
b.cancelHandler);c.popup.element.find(".dialog-title").prepend(f.MovePage.helpLink());a("#createpageform").length>0?x||c.addPage().addHeader(b.title).addPanel(d.I18n.getText("move.page.dialog.ordering.title"),f.MovePage.orderingPagePanel(),"ordering-panel","ordering-panel-id").addLink(d.I18n.getText("move.page.dialog.back.button"),function(a){a.prevPage()},"dialog-back-link").addButton(d.I18n.getText("move.page.dialog.order.button"),r,"reorder-button").addCancel(d.I18n.getText("cancel.name"),b.cancelHandler):
c.addPage().addHeader(b.title).addPanel(d.I18n.getText("move.page.dialog.ordering.title"),f.MovePage.orderingPagePanel(),"ordering-panel","ordering-panel-id").addLink(d.I18n.getText("move.page.dialog.back.button"),function(a){a.prevPage()},"dialog-back-link").addButton(d.I18n.getText("move.page.dialog.order.button"),r,"reorder-button").addCancel(d.I18n.getText("cancel.name"),b.cancelHandler);var s=c.get("button#"+b.buttonName)[0].item;if(a("#createpageform").length>0&&x)a("button.move-button").before(f.MovePage.spinnerButton());
else{a("button.move-button").before(f.MovePage.reorderCheckbox());a("button.reorder-button").before(f.MovePage.spinnerButton());a("#reorderRequirement").before(f.MovePage.spinnerButton())}c.gotoPage(0);var g=a("#move-page-dialog"),q=g.find(".dialog-page-menu"),i=g.find(".dialog-page-body");g.find(".button-spinner").before(f.MovePage.statusMessage());var m=a(q[0]),t=a(i[0]);t.height(m.outerHeight());t.width("75%");q=a(q[1]);i=a(i[1]);q.width("0");i.width("100%");c.show();a(".location-panel .location-info",
g).appendTo(a(".dialog-page-body:first",g));var u=new k.Dialogs.Breadcrumbs.Controller(a("#new-parent-breadcrumbs")),n={moveButton:s,clearErrors:function(){y([])},error:y,select:function(b,c,i,e){d.debug("select: "+[b,c,i].join());a("#createpageform").length>0&&x&&typeof e!=="undefined"&&a("#parentPageId").val(e);o=b;h=c;j=i||"";a(s).prop("disabled",true);u.update({spaceKey:o,title:j},n)}};c.overrideLastTab();c.get('#"'+b.openedPanel+'"').select();var w=e.get("parent-page-title")||e.get("from-page-title");
(new k.Dialogs.Breadcrumbs.Controller(a("#current-parent-breadcrumbs"))).update({spaceKey:e.get("space-key"),title:j||w},n);a(".location-panel",g).movePageLocation(n);a(".search-panel",g).movePageSearch(n);a(".history-panel",g).movePageHistory(n);a("#new-parent-page").select();b.hint&&c.addHelpText(b.hint.template||b.hint.text,b.hint.arguments);K.require("wr!com.atlassian.confluence.plugins.confluence-page-restrictions-dialog:dialog-resources");return g},G=function(a,d,c,f,h){a={pageId:e.get("content-id")||
e.get("page-id"),spaceKey:a};if(c){a.position=f;a.targetId=c}else if(d!==""){a.targetTitle=d;a.position="append"}else a.position="topLevel";a.mode=h;return a};p.bind("deferred.page-move.tools-menu",function(b){b.preventDefault();a("#move-page-dialog").length>0&&a("#move-page-dialog, body > .shadow, body > .aui-blanket").remove();new A({moveHandler:L});return false});var I;p.bind("deferred.page-move.editor",function(b){b.preventDefault();a("#move-page-dialog").length>0&&a("#move-page-dialog, body > .shadow, body > .aui-blanket").remove();
new A({spaceName:I,spaceKey:a("#newSpaceKey").val(),pageTitle:a("#content-title").val(),parentPageTitle:a("#parentPageString").val(),buttonName:d.I18n.getText("move.name"),title:d.I18n.getText("move.page.dialog.title.edit"),moveHandler:function(b,c,f,h,j,k,l){function m(){I=f;a("#newSpaceKey").val(c);a("#parentPageString").val(h);h!==""?a("#position").val("append"):a("#position").val("topLevel");if(a("#createpageform").length>0&&x){var b=a("#parentPageId");typeof b!=="undefined"&&typeof b.val()!==
"undefined"&&e.set("parent-page-id",b.val());typeof c!=="undefined"&&e.set("space-key",c)}if(j){a("#targetId").val(j);a("#position").val(k)}}if(e.get("shared-drafts")){E();D.ajax({url:u()+"/pages/movepage.action",type:"POST",dataType:"json",data:new G(c,h,j,k,H.LEGACY),error:function(a){z();l(C.parseError(a,d.I18n.getText("move.page.dialog.move.failed")))},success:function(a){z();a=[].concat(a.validationErrors||[]).concat(a.actionErrors||[]).concat(a.errorMessage||[]);if(a.length>0)l(a);else{m();
b.remove();B.update(c,h);p.trigger("editor-page-moved")}}})}else{m();b.remove();B.update(c,h);p.trigger("editor-page-moved")}}});return false});p.trigger("page.move.dialog.ready");return A}});require("confluence/module-exporter").safeRequire("confluence/page-move-dialog",function(d){var f=require("confluence/legacy");require("ajs").toInit(function(){f.MovePageDialog=d()})});