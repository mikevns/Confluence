define("confluence/property-panel","jquery ajs confluence/position window document confluence/form-state-control".split(" "),function(e,k,q,o,m,r){var p=function(c,a){a=a||{};o.setTimeout(function(){var d=k.Rte.Content.offset(c.anchor),j=c.panel.width(),g=j+d.left-e(o).width()+10,b=e(c.anchor).outerHeight(),g=d.left-(g>0?g:0)-0,b=c.shouldFlip?d.top-7-c.panel.outerHeight()-4:d.top+7+b;if(c.options.anchorIframe)var h=e(c.options.anchorIframe),h=h.offset().top+h.height()-c.panel.outerHeight()-10,b=Math.min(b,
h);c.panel.find(".property-panel-arrow").css({left:Math.min(Math.abs(d.left-g)+16,j-12)});g=Math.max(0,g);d={top:b,left:g,"z-index":2975};j=c.panel.add();a.animate?j.animate(d,a.animateDuration):j.css(d)},a.delay||0)},n={shouldCreate:true,current:null,getAnchor:function(){return e(this.current.anchor)},createFromButtonModel:function(c,a,d,j){for(var g=e("<div></div>").attr({"class":"panel-buttons"}),b=0,h=d.length;b<h;b++)if(d[b]){var f=d[b],i=f.html||'<span class="icon '+(f.iconClass?f.iconClass:
"")+' "></span>',l=[];f.text&&(i=i+('<span class="panel-button-text">'+f.text+"</span>"));f.className&&l.push(f.className);f.disabled&&l.push("disabled");f.selected&&l.push("active");!d[b+1]&&l.push("last");!d[b-1]&&l.push("first");if(f.html)i=e(f.html);else{i=e("<a></a>").attr({href:d[b].href||"#"}).addClass("aui-button").html(i);if(f.disabled){i.attr("title",f.disabledText);r.disableElement(i);i.click(function(a){a.stopPropagation();return false})}else d[b].click&&function(a,b,c){b.click(function(d){a.click(b,
c);d.stopPropagation();return false})}(d[b],i,a)}i.attr("tabindex","0");i.attr("role","button");f.ariaLabel&&i.attr("aria-label",f.ariaLabel);f.tooltip&&i.attr("data-tooltip",f.tooltip);i.addClass(l.join(" "));g.append(i)}return this.create(c,a,g,j)},create:function(c,a,d,j){j=j||{};k.Rte.BookmarkManager.storeBookmark();var g=e("#property-panel"),b,h=j.enableFlip==void 0||j.enableFlip;g.length&&this.destroy();g=e("<div></div>").addClass("aui-property-panel-parent").addClass(c+"-panel aui-box-shadow").attr("id",
"property-panel").appendTo("body");b=e("<div></div>").addClass("aui-property-panel").append(d);g.append(b).css({top:0,left:-1E4});if(b=h){var h=e(j.anchorIframe||e(a).parent()),f=e(a);b=g.outerHeight()+10;h=q.spaceAboveBelow(h[0],f);b=h.below>=b?false:h.above>=b}var i=this;d.find(".last:last").css({"margin-right":0});d=g;h=e('<div class="property-panel-arrow"></div>');b&&h.addClass("property-panel-bottom-arrow").css({top:d.outerHeight()});d.prepend(h);this.current={anchor:a,panel:g,hasAnchorChanged:function(a){return a&&
i.hasAnchorChanged(a)},snapToElement:function(a){p(this,a)},shouldFlip:b,tip:h,options:j,updating:true,type:c};p(this.current);b=this.current;e(m).bind("keydown.property-panel.escape",function(b){if(b.keyCode===27){n.destroy();a.focus()}});e(m).bind("click.property-panel",function(a){e(a.target).closest("#property-panel").length||n.destroy()});this.trapFocus();k.trigger("created.property-panel",this.current);this.current.updating=false;return this.current},destroy:function(){if(this.current)if(this.current.updating)k.log("PropertyPanel.destroy: called while updating, returning");
else{k.trigger("destroyed.property-panel",this.current);e(m).unbind(".property-panel").unbind(".contextToolbar");this.current.panel.remove();this.current=null}else k.log("PropertyPanel.destroy: called with no current PropertyPanel, returning")},hasAnchorChanged:function(c){var a=this.current;return a&&e(a.anchor)[0]==e(c)[0]?a.options.originalHeight&&a.options.originalHeight!=e(c).height():true},trapFocus:function(){var c=e(".aui-property-panel .aui-button");c.last().on("keydown",function(a){if(a.key===
"Tab"&&!a.shiftKey){a.preventDefault();c.first().focus()}});c.first().on("keydown",function(a){if(a.key==="Tab"&&a.shiftKey){a.preventDefault();c.last().focus()}})}};return n});require("confluence/module-exporter").exportModuleAsGlobal("confluence/property-panel","AJS.Confluence.PropertyPanel");