define("confluence/input-driven-dropdown","ajs jquery confluence/highlighter confluence/legacy window document".split(" "),function(h,f,n,q,i,o){function g(a,e){this._effect="appear";this._timer=null;this.id=a;this.options=e;this.busy=this.inactive=false;this.cacheManager=h.Confluence.cacheManager()}var m=function(a,e){var b=a.options;b.ajsDropDownOptions=b.ajsDropDownOptions||{};var d=(b.ajsDropDownOptions.Highlighter||n)(e.queryTokens||[e.query]);if(!b.ajsDropDownOptions.alignment)b.ajsDropDownOptions.alignment=
"left";b.ajsDropDownOptions.selectionHandler=b.ajsDropDownOptions.selectionHandler||p;var c=a.dd;if(c){c.hide();c.$.remove()}c=a.dd=h.dropDown(e.matrix,b.ajsDropDownOptions)[0];b.ajsDropDownOptions.className&&c.$.addClass(b.ajsDropDownOptions.className);c.$.find("li a:not(.dropdown-prevent-highlight) span").each(function(){var a=f(this);a.html(d.safeHighlight(a.text(),a.data().properties))});if(c.$.hasClass("fabric")){var g=c.$.find(".insert-mentions-dropdown-option");g.length===e.matrix[1].length&&
e.matrix[1].forEach(function(a,b){var c=d.safeHighlight(a.username,a);if(c){a.lozenge&&(c=c+(" &middot; "+a.lozenge));c=f("<span></span>").addClass("dropdown-lozenge").html(c);g.eq(b).append(c)}})}if(b.dropdownPlacement)b.dropdownPlacement(c.$);else{h.log("No dropdownPlacement function specified. Appending dropdown to the body.");f("body").append(c.$)}var j=c.$.closest(".aui-dd-parent").width();if(!j){c.$.width("25em");j=c.$.width()}f("a span:not(.icon)",c.$).each(function(){var a=f(this),b=f("<var>&#8230;</var>"),
c=b.width(),d=false;a.wrapInner(f("<em></em>"));f("em",a).each(function(){var a=f(this);a.show();if(this.offsetLeft+this.offsetWidth+c>j-20){for(var b=this.childNodes,e=false,g=b.length-1;g>=0;g--){var h=b[g],i=1,l=h.nodeType===3?"nodeValue":"innerHTML",k=h[l];do if(i<=k.length)h[l]=k.substr(0,k.length-i++);else break;while(this.offsetLeft+this.offsetWidth+c>j-20);if(i<=k.length){e=true;break}}e?d=true:a.hide()}});if(d){a.append(b);this.elpss=b}});f("a span:not(.icon)",c.$).each(function(){var a=
f(this),b;try{var c=a.data("properties");b=c?c.spaceName:null}catch(d){h.logError("Problem getting space name: "+d.message)}c=a.text();b&&(c=c+(" ("+f("<i></i>").html(b).text()+")"));a.attr("title",c)});b.dropdownPostprocess&&b.dropdownPostprocess(c.$);c.show(a._effect);typeof b.onShow==="function"&&b.onShow.call(c,c.$);return c},p=function(a,e){var b;if(a.type!="click"){b=f("a",e).first();var d=b.attr("href");if(a.type==="keydown"&&(a.metaKey||a.ctrlKey)&&a.which===13){b=i.open(d,"_blank");b.opener=
null}else{b.click();o.location=d}a.preventDefault()}};g.prototype.clearCache=function(){this.cacheManager.clear()};g.prototype.change=function(a,e,b){var d=this;if(a!=d._value){d._value=a;d.busy=false;i.clearTimeout(d._timer);var c=RegExp("\\S{"+(d.options.minLengthForGetData||2)+",}");if(e||c.test(a))if(e=d.cacheManager.get(a))m(d,e);else{d.busy=true;var f=function(){d.options.getDataAndRunCallback.call(d,a,function(){d.show.apply(this,arguments);b&&b(a)})};d.options.dropDownDelay===0?f():d._timer=
i.setTimeout(function(){f()},d.options.dropDownDelay||200)}else{d.dd&&d.dd.hide();b&&b(a)}}};g.prototype.hide=function(){this.dd&&this.dd.hide()};g.prototype.remove=function(){var a=this.dd;if(a){this.hide();a.$.remove()}this.inactive=true;this.options.onDeath&&this.options.onDeath()};g.prototype.show=function(a,e,b){if(this.inactive)h.log("Quick search abandoned before server response received, ignoring. "+this);else{a={matrix:a,query:e,queryTokens:b};this.cacheManager.put(e,a);m(this,a);this.busy=
false}};return g});require("confluence/module-exporter").safeRequire("confluence/input-driven-dropdown",function(h){require("confluence/module-exporter").namespace("AJS.inputDrivenDropdown",function(f){return new h("inputdriven-dropdown",f)})});