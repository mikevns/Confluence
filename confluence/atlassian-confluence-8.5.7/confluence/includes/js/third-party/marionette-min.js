(function(o,f){define("marionette",["backbone","underscore"],function(d,s){return o.Marionette=o.Mn=f(o,d,s)})})(this,function(o,f,d){var s=f.ChildViewContainer,l=d,t=function(a){this._views={};this._indexByModel={};this._indexByCustom={};this._updateLength();l.each(a,this.add,this)};l.extend(t.prototype,{add:function(a,b){var e=a.cid;this._views[e]=a;a.model&&(this._indexByModel[a.model.cid]=e);b&&(this._indexByCustom[b]=e);this._updateLength();return this},findByModel:function(a){return this.findByModelCid(a.cid)},
findByModelCid:function(a){return this.findByCid(this._indexByModel[a])},findByCustom:function(a){return this.findByCid(this._indexByCustom[a])},findByIndex:function(a){return l.values(this._views)[a]},findByCid:function(a){return this._views[a]},remove:function(a){var b=a.cid;a.model&&delete this._indexByModel[a.model.cid];l.any(this._indexByCustom,function(a,c){if(a===b)return delete this._indexByCustom[c],!0},this);delete this._views[b];this._updateLength();return this},call:function(a){this.apply(a,
l.tail(arguments))},apply:function(a,b){l.each(this._views,function(e){l.isFunction(e[a])&&e[a].apply(e,b||[])})},_updateLength:function(){this.length=l.size(this._views)}});l.each("forEach each map find detect filter select reject every all some any include contains invoke toArray first initial rest last without isEmpty pluck reduce".split(" "),function(a){t.prototype[a]=function(){var b=[l.values(this._views)].concat(l.toArray(arguments));return l[a].apply(l,b)}});f.ChildViewContainer=t;f.ChildViewContainer.VERSION=
"0.1.7";f.ChildViewContainer.noConflict=function(){f.ChildViewContainer=s;return this};var j=d,y=f.Wreqr,m=f.Wreqr={};f.Wreqr.VERSION="1.3.3";f.Wreqr.noConflict=function(){f.Wreqr=y;return this};var h=function(a){this.options=a;this._wreqrHandlers={};j.isFunction(this.initialize)&&this.initialize(a)};h.extend=f.Model.extend;j.extend(h.prototype,f.Events,{setHandlers:function(a){j.each(a,function(a,e){var c=null;j.isObject(a)&&!j.isFunction(a)&&(c=a.context,a=a.callback);this.setHandler(e,a,c)},this)},
setHandler:function(a,b,e){this._wreqrHandlers[a]={callback:b,context:e};this.trigger("handler:add",a,b,e)},hasHandler:function(a){return!!this._wreqrHandlers[a]},getHandler:function(a){var b=this._wreqrHandlers[a];if(b)return function(){return b.callback.apply(b.context,arguments)}},removeHandler:function(a){delete this._wreqrHandlers[a]},removeAllHandlers:function(){this._wreqrHandlers={}}});m.Handlers=h;h=function(a){this.options=a;this._commands={};j.isFunction(this.initialize)&&this.initialize(a)};
j.extend(h.prototype,f.Events,{getCommands:function(a){var b=this._commands[a];b||(b={command:a,instances:[]},this._commands[a]=b);return b},addCommand:function(a,b){this.getCommands(a).instances.push(b)},clearCommands:function(a){this.getCommands(a).instances=[]}});m.CommandStorage=h;h=m.Handlers.extend({storageType:m.CommandStorage,constructor:function(a){this.options=a||{};this._initializeStorage(this.options);this.on("handler:add",this._executeCommands,this);m.Handlers.prototype.constructor.apply(this,
arguments)},execute:function(a){var a=arguments[0],b=j.rest(arguments);this.hasHandler(a)?this.getHandler(a).apply(this,b):this.storage.addCommand(a,b)},_executeCommands:function(a,b,e){var c=this.storage.getCommands(a);j.each(c.instances,function(a){b.apply(e,a)});this.storage.clearCommands(a)},_initializeStorage:function(a){a=a.storageType||this.storageType;this.storage=j.isFunction(a)?new a:a}});m.Commands=h;h=m.Handlers.extend({request:function(a){if(this.hasHandler(a))return this.getHandler(a).apply(this,
j.rest(arguments))}});m.RequestResponse=h;h=function(){};h.extend=f.Model.extend;j.extend(h.prototype,f.Events);m.EventAggregator=h;h=function(a){this.vent=new f.Wreqr.EventAggregator;this.reqres=new f.Wreqr.RequestResponse;this.commands=new f.Wreqr.Commands;this.channelName=a};j.extend(h.prototype,{reset:function(){this.vent.off();this.vent.stopListening();this.reqres.removeAllHandlers();this.commands.removeAllHandlers();return this},connectEvents:function(a,b){this._connect("vent",a,b);return this},
connectCommands:function(a,b){this._connect("commands",a,b);return this},connectRequests:function(a,b){this._connect("reqres",a,b);return this},_connect:function(a,b,e){if(b){var e=e||this,c="vent"===a?"on":"setHandler";j.each(b,function(b,d){this[a][c](d,j.bind(b,e))},this)}}});m.Channel=h;h=function(){this._channels={};this.vent={};this.commands={};this.reqres={};this._proxyMethods()};j.extend(h.prototype,{channel:function(a){if(!a)throw Error("Channel must receive a name");return this._getChannel(a)},
_getChannel:function(a){var b=this._channels[a];b||(b=new m.Channel(a),this._channels[a]=b);return b},_proxyMethods:function(){j.each(["vent","commands","reqres"],function(a){j.each(z[a],function(b){var e=this;this[a][b]=function(c){var d=e._getChannel(c)[a];return d[b].apply(d,j.rest(arguments))}},this)},this)}});var z={vent:"on off trigger once stopListening listenTo listenToOnce".split(" "),commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler",
"setHandlers","removeHandler","removeAllHandlers"]},h=new h;m.radio=h;var A=o.Marionette,B=o.Mn,c=f.Marionette={};c.VERSION="2.4.2";c.noConflict=function(){o.Marionette=A;o.Mn=B;return this};f.Marionette=c;c.Deferred=f.$.Deferred;c.extend=f.Model.extend;c.isNodeAttached=function(a){return f.$.contains(document.documentElement,a)};c.mergeOptions=function(a,b){a&&d.extend(this,d.pick(a,b))};c.getOption=function(a,b){if(a&&b)return a.options&&void 0!==a.options[b]?a.options[b]:a[b]};c.proxyGetOption=
function(a){return c.getOption(this,a)};c._getValue=function(a,b,e){d.isFunction(a)&&(a=e?a.apply(b,e):a.call(b));return a};c.normalizeMethods=function(a){return d.reduce(a,function(a,e,c){d.isFunction(e)||(e=this[e]);e&&(a[c]=e);return a},{},this)};c.normalizeUIString=function(a,b){return a.replace(/@ui\.[a-zA-Z_$0-9]*/g,function(a){return b[a.slice(4)]})};c.normalizeUIKeys=function(a,b){return d.reduce(a,function(a,d,g){g=c.normalizeUIString(g,b);a[g]=d;return a},{})};c.normalizeUIValues=function(a,
b,e){d.each(a,function(i,g){d.isString(i)?a[g]=c.normalizeUIString(i,b):d.isObject(i)&&d.isArray(e)&&(d.extend(i,c.normalizeUIValues(d.pick(i,e),b)),d.each(e,function(a){var e=i[a];d.isString(e)&&(i[a]=c.normalizeUIString(e,b))}))});return a};c.actAsCollection=function(a,b){d.each("forEach each map find detect filter select reject every all some any include contains invoke toArray first initial rest last without isEmpty pluck".split(" "),function(e){a[e]=function(){var a=[d.values(d.result(this,b))].concat(d.toArray(arguments));
return d[e].apply(d,a)}})};var q=c.deprecate=function(a,b){d.isObject(a)&&(a=a.prev+" is going to be removed in the future. Please use "+a.next+" instead."+(a.url?" See: "+a.url:""));if((void 0===b||!b)&&!q._cache[a])q._warn("Deprecation warning: "+a),q._cache[a]=!0};q._warn="undefined"!==typeof console&&(console.warn||console.log)||function(){};q._cache={};var C=function(a,b,e){return e.toUpperCase()},D=/(^|:)(\w)/gi;c._triggerMethod=function(a,b,e){var c=3>arguments.length;c&&(e=b,b=e[0]);var g=
"on"+b.replace(D,C),g=a[g],f;d.isFunction(g)&&(f=g.apply(a,c?d.rest(e):e));d.isFunction(a.trigger)&&(1<c+e.length?a.trigger.apply(a,c?e:[b].concat(d.drop(e,0))):a.trigger(b));return f};c.triggerMethod=function(a){return c._triggerMethod(this,arguments)};c.triggerMethodOn=function(a){return(d.isFunction(a.triggerMethod)?a.triggerMethod:c.triggerMethod).apply(a,d.rest(arguments))};c.MonitorDOMRefresh=function(a){function b(){a._isShown&&a._isRendered&&c.isNodeAttached(a.el)&&d.isFunction(a.triggerMethod)&&
a.triggerMethod("dom:refresh")}a.on({show:function(){a._isShown=!0;b()},render:function(){a._isRendered=!0;b()}})};var n=c,E=function(a,b,e,c){c=c.split(/\s+/);d.each(c,function(c){var d=a[c];if(!d)throw new n.Error('Method "'+c+'" was configured as an event handler, but does not exist.');a.listenTo(b,e,d)})},F=function(a,b,e,c){a.listenTo(b,e,c)},G=function(a,b,e,c){c=c.split(/\s+/);d.each(c,function(c){a.stopListening(b,e,a[c])})},H=function(a,b,e,c){a.stopListening(b,e,c)},u=function(a,b,e,c,g){if(b&&
e){if(!d.isObject(e))throw new n.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});e=n._getValue(e,a);d.each(e,function(e,f){d.isFunction(e)?c(a,b,f,e):g(a,b,f,e)})}};n.bindEntityEvents=function(a,b,e){u(a,b,e,F,E)};n.unbindEntityEvents=function(a,b,e){u(a,b,e,H,G)};n.proxyBindEntityEvents=function(a,b){return n.bindEntityEvents(this,a,b)};n.proxyUnbindEntityEvents=function(a,b){return n.unbindEntityEvents(this,a,b)};var v="description fileName lineNumber name message number".split(" ");
c.Error=c.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+c.VERSION+"/",constructor:function(a,b){d.isObject(a)?(b=a,a=b.message):b||(b={});var e=Error.call(this,a);d.extend(this,d.pick(e,v),d.pick(b,v));this.captureStackTrace();b.url&&(this.url=this.urlRoot+b.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,c.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}});c.Error.extend=c.extend;c.Callbacks=function(){this._deferred=
c.Deferred();this._callbacks=[]};d.extend(c.Callbacks.prototype,{add:function(a,b){var e=d.result(this._deferred,"promise");this._callbacks.push({cb:a,ctx:b});e.then(function(e){b&&(e.context=b);a.call(e.context,e.options)})},run:function(a,b){this._deferred.resolve({options:a,context:b})},reset:function(){var a=this._callbacks;this._deferred=c.Deferred();this._callbacks=[];d.each(a,function(a){this.add(a.cb,a.ctx)},this)}});c.Controller=function(a){this.options=a||{};d.isFunction(this.initialize)&&
this.initialize(this.options)};c.Controller.extend=c.extend;d.extend(c.Controller.prototype,f.Events,{destroy:function(){c._triggerMethod(this,"before:destroy",arguments);c._triggerMethod(this,"destroy",arguments);this.stopListening();this.off();return this},triggerMethod:c.triggerMethod,mergeOptions:c.mergeOptions,getOption:c.proxyGetOption});c.Object=function(a){this.options=d.extend({},d.result(this,"options"),a);this.initialize.apply(this,arguments)};c.Object.extend=c.extend;d.extend(c.Object.prototype,
f.Events,{initialize:function(){},destroy:function(){this.triggerMethod("before:destroy");this.triggerMethod("destroy");this.stopListening();return this},triggerMethod:c.triggerMethod,mergeOptions:c.mergeOptions,getOption:c.proxyGetOption,bindEntityEvents:c.proxyBindEntityEvents,unbindEntityEvents:c.proxyUnbindEntityEvents});c.Region=c.Object.extend({constructor:function(a){this.options=a||{};this.el=this.getOption("el");this.el=this.el instanceof f.$?this.el[0]:this.el;if(!this.el)throw new c.Error({name:"NoElError",
message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el);c.Object.call(this,a)},show:function(a,b){if(this._ensureElement()){this._ensureViewIsIntact(a);var e=b||{},i=a!==this.currentView,g=!!e.preventDestroy,f=!!e.forceShow,h=!!this.currentView,g=i&&!g,i=i||f;h&&this.triggerMethod("before:swapOut",this.currentView,this,b);this.currentView&&delete this.currentView._parent;g?this.empty():h&&i&&this.currentView.off("destroy",this.empty,this);i&&(a.once("destroy",this.empty,this),
a.render(),a._parent=this,h&&this.triggerMethod("before:swap",a,this,b),this.triggerMethod("before:show",a,this,b),c.triggerMethodOn(a,"before:show",a,this,b),h&&this.triggerMethod("swapOut",this.currentView,this,b),i=c.isNodeAttached(this.el),f=[],e=d.extend({triggerBeforeAttach:this.triggerBeforeAttach,triggerAttach:this.triggerAttach},e),i&&e.triggerBeforeAttach&&(f=this._displayedViews(a),this._triggerAttach(f,"before:")),this.attachHtml(a),this.currentView=a,i&&e.triggerAttach&&(f=this._displayedViews(a),
this._triggerAttach(f)),h&&this.triggerMethod("swap",a,this,b),this.triggerMethod("show",a,this,b),c.triggerMethodOn(a,"show",a,this,b));return this}},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(a,b){var e=(b||"")+"attach";d.each(a,function(a){c.triggerMethodOn(a,e,a,this)},this)},_displayedViews:function(a){return d.union([a],d.result(a,"_getNestedViews")||[])},_ensureElement:function(){d.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]);if(!this.$el||0===
this.$el.length){if(this.getOption("allowMissingEl"))return!1;throw new c.Error('An "el" '+this.$el.selector+" must exist in DOM");}return!0},_ensureViewIsIntact:function(a){if(!a)throw new c.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(a.isDestroyed)throw new c.Error({name:"ViewDestroyedError",message:'View (cid: "'+a.cid+'") has already been destroyed and cannot be used.'});},getEl:function(a){return f.$(a,c._getValue(this.options.parentEl,
this))},attachHtml:function(a){this.$el.contents().detach();this.el.appendChild(a.el)},empty:function(a){var b=this.currentView,a=c._getValue(a,"preventDestroy",this);if(b)return b.off("destroy",this.empty,this),this.triggerMethod("before:empty",b),a||this._destroyView(),this.triggerMethod("empty",b),delete this.currentView,a&&this.$el.contents().detach(),this},_destroyView:function(){var a=this.currentView;a.destroy&&!a.isDestroyed?a.destroy():a.remove&&(a.remove(),a.isDestroyed=!0)},attachView:function(a){this.currentView=
a;return this},hasView:function(){return!!this.currentView},reset:function(){this.empty();this.$el&&(this.el=this.$el.selector);delete this.$el;return this}},{buildRegion:function(a,b){if(d.isString(a))return this._buildRegionFromSelector(a,b);if(a.selector||a.el||a.regionClass)return this._buildRegionFromObject(a,b);if(d.isFunction(a))return this._buildRegionFromRegionClass(a);throw new c.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"});
},_buildRegionFromSelector:function(a,b){return new b({el:a})},_buildRegionFromObject:function(a,b){var e=a.regionClass||b,c=d.omit(a,"selector","regionClass");a.selector&&!c.el&&(c.el=a.selector);return new e(c)},_buildRegionFromRegionClass:function(a){return new a}});c.RegionManager=c.Controller.extend({constructor:function(a){this._regions={};this.length=0;c.Controller.call(this,a);this.addRegions(this.getOption("regions"))},addRegions:function(a,b){a=c._getValue(a,this,arguments);return d.reduce(a,
function(a,c,g){d.isString(c)&&(c={selector:c});c.selector&&(c=d.defaults({},c,b));a[g]=this.addRegion(g,c);return a},{},this)},addRegion:function(a,b){var e;e=b instanceof c.Region?b:c.Region.buildRegion(b,c.Region);this.triggerMethod("before:add:region",a,e);e._parent=this;this._store(a,e);this.triggerMethod("add:region",a,e);return e},get:function(a){return this._regions[a]},getRegions:function(){return d.clone(this._regions)},removeRegion:function(a){var b=this._regions[a];this._remove(a,b);return b},
removeRegions:function(){var a=this.getRegions();d.each(this._regions,function(a,e){this._remove(e,a)},this);return a},emptyRegions:function(){var a=this.getRegions();d.invoke(a,"empty");return a},destroy:function(){this.removeRegions();return c.Controller.prototype.destroy.apply(this,arguments)},_store:function(a,b){this._regions[a]||this.length++;this._regions[a]=b},_remove:function(a,b){this.triggerMethod("before:remove:region",a,b);b.empty();b.stopListening();delete b._parent;delete this._regions[a];
this.length--;this.triggerMethod("remove:region",a,b)}});c.actAsCollection(c.RegionManager.prototype,"_regions");c.TemplateCache=function(a){this.templateId=a};d.extend(c.TemplateCache,{templateCaches:{},get:function(a,b){var e=this.templateCaches[a];e||(e=new c.TemplateCache(a),this.templateCaches[a]=e);return e.load(b)},clear:function(){var a,b=d.toArray(arguments),e=b.length;if(0<e)for(a=0;a<e;a++)delete this.templateCaches[b[a]];else this.templateCaches={}}});d.extend(c.TemplateCache.prototype,
{load:function(a){if(this.compiledTemplate)return this.compiledTemplate;var b=this.loadTemplate(this.templateId,a);return this.compiledTemplate=this.compileTemplate(b,a)},loadTemplate:function(a){var b=f.$(a).html();if(!b||0===b.length)throw new c.Error({name:"NoTemplateError",message:'Could not find template: "'+a+'"'});return b},compileTemplate:function(a,b){return d.template(a,b)}});c.Renderer={render:function(a,b){if(!a)throw new c.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});
return(d.isFunction(a)?a:c.TemplateCache.get(a))(b)}};c.View=f.View.extend({isDestroyed:!1,constructor:function(a){d.bindAll(this,"render");a=c._getValue(a,this);this.options=d.extend({},d.result(this,"options"),a);this._behaviors=c.Behaviors(this);f.View.call(this,this.options);c.MonitorDOMRefresh(this)},getTemplate:function(){return this.getOption("template")},serializeModel:function(a){return a.toJSON.apply(a,d.rest(arguments))},mixinTemplateHelpers:function(a){var a=a||{},b=this.getOption("templateHelpers"),
b=c._getValue(b,this);return d.extend(a,b)},normalizeUIKeys:function(a){var b=d.result(this,"_uiBindings");return c.normalizeUIKeys(a,b||d.result(this,"ui"))},normalizeUIValues:function(a,b){var e=d.result(this,"ui"),i=d.result(this,"_uiBindings");return c.normalizeUIValues(a,i||e,b)},configureTriggers:function(){if(this.triggers){var a=this.normalizeUIKeys(d.result(this,"triggers"));return d.reduce(a,function(a,e,c){a[c]=this._buildViewTrigger(e);return a},{},this)}},delegateEvents:function(a){this._delegateDOMEvents(a);
this.bindEntityEvents(this.model,this.getOption("modelEvents"));this.bindEntityEvents(this.collection,this.getOption("collectionEvents"));d.each(this._behaviors,function(a){a.bindEntityEvents(this.model,a.getOption("modelEvents"));a.bindEntityEvents(this.collection,a.getOption("collectionEvents"))},this);return this},_delegateDOMEvents:function(a){var b=c._getValue(a||this.events,this),b=this.normalizeUIKeys(b);d.isUndefined(a)&&(this.events=b);var a={},e=d.result(this,"behaviorEvents")||{},i=this.configureTriggers(),
g=d.result(this,"behaviorTriggers")||{};d.extend(a,e,b,i,g);f.View.prototype.delegateEvents.call(this,a)},undelegateEvents:function(){f.View.prototype.undelegateEvents.apply(this,arguments);this.unbindEntityEvents(this.model,this.getOption("modelEvents"));this.unbindEntityEvents(this.collection,this.getOption("collectionEvents"));d.each(this._behaviors,function(a){a.unbindEntityEvents(this.model,a.getOption("modelEvents"));a.unbindEntityEvents(this.collection,a.getOption("collectionEvents"))},this);
return this},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new c.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'});},destroy:function(){if(this.isDestroyed)return this;var a=d.toArray(arguments);this.triggerMethod.apply(this,["before:destroy"].concat(a));this.isDestroyed=!0;this.triggerMethod.apply(this,["destroy"].concat(a));this.unbindUIElements();this.isRendered=!1;this.remove();d.invoke(this._behaviors,"destroy",a);
return this},bindUIElements:function(){this._bindUIElements();d.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var a=d.result(this,"_uiBindings");this.ui={};d.each(a,function(a,e){this.ui[e]=this.$(a)},this)}},unbindUIElements:function(){this._unbindUIElements();d.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(d.each(this.ui,function(a,b){delete this.ui[b]},
this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(a){var b=d.isObject(a),e=d.defaults({},b?a:{},{preventDefault:!0,stopPropagation:!0}),c=b?e.event:a;return function(a){a&&(a.preventDefault&&e.preventDefault&&a.preventDefault(),a.stopPropagation&&e.stopPropagation&&a.stopPropagation());this.triggerMethod(c,{view:this,model:this.model,collection:this.collection})}},setElement:function(){var a=f.View.prototype.setElement.apply(this,arguments);d.invoke(this._behaviors,
"proxyViewProperties",this);return a},triggerMethod:function(){var a=c._triggerMethod(this,arguments);this._triggerEventOnBehaviors(arguments);this._triggerEventOnParentLayout(arguments[0],d.rest(arguments));return a},_triggerEventOnBehaviors:function(a){for(var b=c._triggerMethod,e=this._behaviors,d=0,g=e&&e.length;d<g;d++)b(e[d],a)},_triggerEventOnParentLayout:function(a,b){var e=this._parentLayoutView();if(e){var i=c.getOption(e,"childViewEventPrefix")+":"+a;c._triggerMethod(e,[i,this].concat(b));
i=c.getOption(e,"childEvents");(i=e.normalizeMethods(i))&&d.isFunction(i[a])&&i[a].apply(e,[this].concat(b))}},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var a=this._getImmediateChildren();return!a.length?a:d.reduce(a,function(a,e){return!e._getNestedViews?a:a.concat(e._getNestedViews())},a)},_getAncestors:function(){for(var a=[],b=this._parent;b;)a.push(b),b=b._parent;return a},_parentLayoutView:function(){var a=this._getAncestors();return d.find(a,function(a){return a instanceof
c.LayoutView})},normalizeMethods:c.normalizeMethods,mergeOptions:c.mergeOptions,getOption:c.proxyGetOption,bindEntityEvents:c.proxyBindEntityEvents,unbindEntityEvents:c.proxyUnbindEntityEvents});c.ItemView=c.View.extend({constructor:function(){c.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection)return{};var a=[this.model||this.collection];arguments.length&&a.push.apply(a,arguments);return this.model?this.serializeModel.apply(this,a):{items:this.serializeCollection.apply(this,
a)}},serializeCollection:function(a){return a.toJSON.apply(a,d.rest(arguments))},render:function(){this._ensureViewIsIntact();this.triggerMethod("before:render",this);this._renderTemplate();this.isRendered=!0;this.bindUIElements();this.triggerMethod("render",this);return this},_renderTemplate:function(){var a=this.getTemplate();if(!1!==a){if(!a)throw new c.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var b=this.mixinTemplateHelpers(this.serializeData()),
a=c.Renderer.render(a,b,this);this.attachElContent(a);return this}},attachElContent:function(a){this.$el.html(a);return this}});c.CollectionView=c.View.extend({childViewEventPrefix:"childview",sort:!0,constructor:function(a){this.once("render",this._initialEvents);this._initChildViewStorage();c.View.apply(this,arguments);this.on({"before:show":this._onBeforeShowCalled,show:this._onShowCalled,"before:attach":this._onBeforeAttachCalled,attach:this._onAttachCalled});this.initRenderBuffer()},initRenderBuffer:function(){this._bufferedChildren=
[]},startBuffering:function(){this.initRenderBuffer();this.isBuffering=!0},endBuffering:function(){var a=this._isShown&&c.isNodeAttached(this.el),b;this.isBuffering=!1;this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"before:show");a&&this._triggerBeforeAttach&&(b=this._getNestedViews(),this._triggerMethodMany(b,this,"before:attach"));this.attachBuffer(this,this._createBuffer());a&&this._triggerAttach&&(b=this._getNestedViews(),this._triggerMethodMany(b,this,"attach"));this._isShown&&
this._triggerMethodMany(this._bufferedChildren,this,"show");this.initRenderBuffer()},_triggerMethodMany:function(a,b,e){var i=d.drop(arguments,3);d.each(a,function(a){c.triggerMethodOn.apply(a,[a,e,a,b].concat(i))})},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},
_onCollectionAdd:function(a,b,e){b=void 0!==e.at?e.at:d.indexOf(this._filteredSortedModels(),a);this._shouldAddChild(a,b)&&(this.destroyEmptyView(),e=this.getChildView(a),this.addChild(a,e,b))},_onCollectionRemove:function(a){a=this.children.findByModel(a);this.removeChildView(a);this.checkEmpty()},_onBeforeShowCalled:function(){this._triggerBeforeAttach=this._triggerAttach=!1;this.children.each(function(a){c.triggerMethodOn(a,"before:show",a)})},_onShowCalled:function(){this.children.each(function(a){c.triggerMethodOn(a,
"show",a)})},_onBeforeAttachCalled:function(){this._triggerBeforeAttach=!0},_onAttachCalled:function(){this._triggerAttach=!0},render:function(){this._ensureViewIsIntact();this.triggerMethod("before:render",this);this._renderChildren();this.isRendered=!0;this.triggerMethod("render",this);return this},reorder:function(){var a=this.children,b=this._filteredSortedModels();d.find(b,function(b){return!a.findByModel(b)})?this.render():(b=d.map(b,function(b,c){var d=a.findByModel(b);d._index=c;return d.el}),
this.triggerMethod("before:reorder"),this._appendReorderedChildren(b),this.triggerMethod("reorder"))},resortView:function(){c.getOption(this,"reorderOnSort")?this.reorder():this.render()},_sortViews:function(){var a=this._filteredSortedModels();d.find(a,function(a,e){var c=this.children.findByModel(a);return!c||c._index!==e},this)&&this.resortView()},_emptyViewIndex:-1,_appendReorderedChildren:function(a){this.$el.append(a)},_renderChildren:function(){this.destroyEmptyView();this.destroyChildren({checkEmpty:!1});
this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this),this.children.isEmpty()&&this.showEmptyView())},showCollection:function(){var a,b=this._filteredSortedModels();d.each(b,function(b,c){a=this.getChildView(b);this.addChild(b,a,c)},this)},_filteredSortedModels:function(){var a;a=(a=this.getViewComparator())?d.isString(a)||1===a.length?this.collection.sortBy(a,
this):d.clone(this.collection.models).sort(d.bind(a,this)):this.collection.models;this.getOption("filter")&&(a=d.filter(a,function(a,c){return this._shouldAddChild(a,c)},this));return a},showEmptyView:function(){var a=this.getEmptyView();if(a&&!this._showingEmptyView){this.triggerMethod("before:render:empty");this._showingEmptyView=!0;var b=new f.Model;this.addEmptyView(b,a);this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),
this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(a,b){var e=this._isShown&&!this.isBuffering&&c.isNodeAttached(this.el),i,g=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");d.isFunction(g)&&(g=g.call(this,a,this._emptyViewIndex));g=this.buildChildView(a,b,g);g._parent=this;this.proxyChildEvents(g);this._isShown&&c.triggerMethodOn(g,"before:show",g);this.children.add(g);
e&&this._triggerBeforeAttach&&(i=[g].concat(g._getNestedViews()),g.once("render",function(){this._triggerMethodMany(i,this,"before:attach")},this));this.renderChildView(g,this._emptyViewIndex);e&&this._triggerAttach&&(i=[g].concat(g._getNestedViews()),this._triggerMethodMany(i,this,"attach"));this._isShown&&c.triggerMethodOn(g,"show",g)},getChildView:function(){var a=this.getOption("childView");if(!a)throw new c.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return a},
addChild:function(a,b,e){var d=this.getOption("childViewOptions"),d=c._getValue(d,this,[a,e]),a=this.buildChildView(a,b,d);this._updateIndices(a,!0,e);this.triggerMethod("before:add:child",a);this._addChildView(a,e);this.triggerMethod("add:child",a);a._parent=this;return a},_updateIndices:function(a,b,c){this.getOption("sort")&&(b&&(a._index=c),this.children.each(function(c){if(c._index>=a._index)c._index=c._index+(b?1:-1)}))},_addChildView:function(a,b){var e=this._isShown&&!this.isBuffering&&c.isNodeAttached(this.el),
d;this.proxyChildEvents(a);this._isShown&&!this.isBuffering&&c.triggerMethodOn(a,"before:show",a);this.children.add(a);e&&this._triggerBeforeAttach&&(d=[a].concat(a._getNestedViews()),a.once("render",function(){this._triggerMethodMany(d,this,"before:attach")},this));this.renderChildView(a,b);e&&this._triggerAttach&&(d=[a].concat(a._getNestedViews()),this._triggerMethodMany(d,this,"attach"));this._isShown&&!this.isBuffering&&c.triggerMethodOn(a,"show",a)},renderChildView:function(a,b){a.render();this.attachHtml(this,
a,b);return a},buildChildView:function(a,b,c){a=d.extend({model:a},c);return new b(a)},removeChildView:function(a){a&&(this.triggerMethod("before:remove:child",a),a.destroy?a.destroy():a.remove&&a.remove(),delete a._parent,this.stopListening(a),this.children.remove(a),this.triggerMethod("remove:child",a),this._updateIndices(a,!1));return a},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(a,
b){a.$el.append(b)},_createBuffer:function(){var a=document.createDocumentFragment();d.each(this._bufferedChildren,function(b){a.appendChild(b.el)});return a},attachHtml:function(a,b,c){a.isBuffering?a._bufferedChildren.splice(c,0,b):a._insertBefore(b,c)||a._insertAfter(b)},_insertBefore:function(a,b){var c;this.getOption("sort")&&b<this.children.length-1&&(c=this.children.find(function(a){return a._index===b+1}));return c?(c.$el.before(a.el),!0):!1},_insertAfter:function(a){this.$el.append(a.el)},
_initChildViewStorage:function(){this.children=new f.ChildViewContainer},destroy:function(){if(this.isDestroyed)return this;this.triggerMethod("before:destroy:collection");this.destroyChildren({checkEmpty:!1});this.triggerMethod("destroy:collection");return c.View.prototype.destroy.apply(this,arguments)},destroyChildren:function(a){var a=a||{},b=!0,c=this.children.map(d.identity);d.isUndefined(a.checkEmpty)||(b=a.checkEmpty);this.children.each(this.removeChildView,this);b&&this.checkEmpty();return c},
_shouldAddChild:function(a,b){var c=this.getOption("filter");return!d.isFunction(c)||c.call(this,a,b,this.collection)},proxyChildEvents:function(a){var b=this.getOption("childViewEventPrefix");this.listenTo(a,"all",function(){var c=d.toArray(arguments),i=c[0],g=this.normalizeMethods(d.result(this,"childEvents"));c[0]=b+":"+i;c.splice(1,0,a);"undefined"!==typeof g&&d.isFunction(g[i])&&g[i].apply(this,c.slice(1));this.triggerMethod.apply(this,c)})},_getImmediateChildren:function(){return d.values(this.children._views)},
getViewComparator:function(){return this.getOption("viewComparator")}});c.CompositeView=c.CollectionView.extend({constructor:function(){c.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(){return this.getOption("childView")||
this.constructor},serializeData:function(){var a={};this.model&&(a=d.partial(this.serializeModel,this.model).apply(this,arguments));return a},render:function(){this._ensureViewIsIntact();this._isRendering=!0;this.resetChildViewContainer();this.triggerMethod("before:render",this);this._renderTemplate();this._renderChildren();this._isRendering=!1;this.isRendered=!0;this.triggerMethod("render",this);return this},_renderChildren:function(){(this.isRendered||this._isRendering)&&c.CollectionView.prototype._renderChildren.call(this)},
_renderTemplate:function(){var a={},a=this.serializeData(),a=this.mixinTemplateHelpers(a);this.triggerMethod("before:render:template");var b=this.getTemplate(),a=c.Renderer.render(b,a,this);this.attachElContent(a);this.bindUIElements();this.triggerMethod("render:template")},attachElContent:function(a){this.$el.html(a);return this},attachBuffer:function(a,b){this.getChildViewContainer(a).append(b)},_insertAfter:function(a){this.getChildViewContainer(this,a).append(a.el)},_appendReorderedChildren:function(a){this.getChildViewContainer(this).append(a)},
getChildViewContainer:function(a){if(a.$childViewContainer)return a.$childViewContainer;var b;if(b=c.getOption(a,"childViewContainer")){if(b=c._getValue(b,a),b="@"===b.charAt(0)&&a.ui?a.ui[b.substr(4)]:a.$(b),0>=b.length)throw new c.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+a.childViewContainer});}else b=a.$el;return a.$childViewContainer=b},resetChildViewContainer:function(){this.$childViewContainer&&(this.$childViewContainer=void 0)}});
c.LayoutView=c.ItemView.extend({regionClass:c.Region,options:{destroyImmediate:!1},childViewEventPrefix:"childview",constructor:function(a){a=a||{};this._firstRender=!0;this._initializeRegions(a);c.ItemView.call(this,a)},render:function(){this._ensureViewIsIntact();this._firstRender?this._firstRender=!1:this._reInitializeRegions();return c.ItemView.prototype.render.apply(this,arguments)},destroy:function(){if(this.isDestroyed)return this;!0===this.getOption("destroyImmediate")&&this.$el.remove();
this.regionManager.destroy();return c.ItemView.prototype.destroy.apply(this,arguments)},showChildView:function(a,b){return this.getRegion(a).show(b)},getChildView:function(a){return this.getRegion(a).currentView},addRegion:function(a,b){var c={};c[a]=b;return this._buildRegions(c)[a]},addRegions:function(a){this.regions=d.extend({},this.regions,a);return this._buildRegions(a)},removeRegion:function(a){delete this.regions[a];return this.regionManager.removeRegion(a)},getRegion:function(a){return this.regionManager.get(a)},
getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(a){var b={regionClass:this.getOption("regionClass"),parentEl:d.partial(d.result,this,"el")};return this.regionManager.addRegions(a,b)},_initializeRegions:function(a){var b;this._initRegionManager();b=c._getValue(this.regions,this,[a])||{};var e=this.getOption.call(a,"regions"),e=c._getValue(e,this,[a]);d.extend(b,e);b=this.normalizeUIValues(b,["selector","el"]);this.addRegions(b)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},
getRegionManager:function(){return new c.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager();this.regionManager._parent=this;this.listenTo(this.regionManager,"before:add:region",function(a){this.triggerMethod("before:add:region",a)});this.listenTo(this.regionManager,"add:region",function(a,b){this[a]=b;this.triggerMethod("add:region",a,b)});this.listenTo(this.regionManager,"before:remove:region",function(a){this.triggerMethod("before:remove:region",a)});this.listenTo(this.regionManager,
"remove:region",function(a,b){delete this[a];this.triggerMethod("remove:region",a,b)})},_getImmediateChildren:function(){return d.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}});c.Behavior=c.Object.extend({constructor:function(a,b){this.view=b;this.defaults=d.result(this,"defaults")||{};this.options=d.extend({},this.defaults,a);this.ui=d.extend({},d.result(b,"ui"),d.result(this,"ui"));c.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,
arguments)},destroy:function(){this.stopListening();return this},proxyViewProperties:function(a){this.$el=a.$el;this.el=a.el}});var r=h=c,k=d,p=function(a,b){if(!k.isObject(a.behaviors))return{};b=p.parseBehaviors(a,b||k.result(a,"behaviors"));p.wrap(a,b,k.keys(w));return b},x=function(a,b){this._view=a;this._behaviors=b;this._triggers={}},I=/^(\S+)\s*(.*)$/,w={behaviorTriggers:function(a,b){return(new x(this,b)).buildBehaviorTriggers()},behaviorEvents:function(a,b){var c={};k.each(b,function(a,b){var d=
{},f=k.clone(k.result(a,"events"))||{},f=r.normalizeUIKeys(f,a._uiBindings||a.ui),h=0;k.each(f,function(c,e){var f=e.match(I),f=f[1]+"."+[this.cid,b,h++," "].join("")+f[2],j=k.isFunction(c)?c:a[c];d[f]=k.bind(j,a)},this);c=k.extend(c,d)},this);return c}};k.extend(p,{behaviorsLookup:function(){throw new r.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"});},getBehaviorClass:function(a,b){return a.behaviorClass?a.behaviorClass:r._getValue(p.behaviorsLookup,
this,[a,b])[b]},parseBehaviors:function(a,b){return k.chain(b).map(function(b,c){var d=new (p.getBehaviorClass(b,c))(b,a),f=p.parseBehaviors(a,k.result(d,"behaviors"));return[d].concat(f)}).flatten().value()},wrap:function(a,b,c){k.each(c,function(c){a[c]=k.partial(w[c],a[c],b)})}});k.extend(x.prototype,{buildBehaviorTriggers:function(){k.each(this._behaviors,this._buildTriggerHandlersForBehavior,this);return this._triggers},_buildTriggerHandlersForBehavior:function(a,b){var c=k.clone(k.result(a,
"triggers"))||{},c=r.normalizeUIKeys(c,a._uiBindings||a.ui);k.each(c,k.bind(this._setHandlerForBehavior,this,a,b))},_setHandlerForBehavior:function(a,b,c,d){a=d.replace(/^\S+/,function(a){return a+".behaviortriggers"+b});this._triggers[a]=this._view._buildViewTrigger(c)}});h.Behaviors=p;c.AppRouter=f.Router.extend({constructor:function(a){this.options=a||{};f.Router.apply(this,arguments);var b=this.getOption("appRoutes"),c=this._getController();this.processAppRoutes(c,b);this.on("route",this._processOnRoute,
this)},appRoute:function(a,b){var c=this._getController();this._addAppRoute(c,a,b)},_processOnRoute:function(a,b){if(d.isFunction(this.onRoute)){var c=d.invert(this.getOption("appRoutes"))[a];this.onRoute(a,c,b)}},processAppRoutes:function(a,b){if(b){var c=d.keys(b).reverse();d.each(c,function(c){this._addAppRoute(a,c,b[c])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(a,b,e){var f=a[e];if(!f)throw new c.Error('Method "'+e+'" was not found on the controller');
this.route(b,e,d.bind(f,a))},mergeOptions:c.mergeOptions,getOption:c.proxyGetOption,triggerMethod:c.triggerMethod,bindEntityEvents:c.proxyBindEntityEvents,unbindEntityEvents:c.proxyUnbindEntityEvents});c.Application=c.Object.extend({constructor:function(a){this._initializeRegions(a);this._initCallbacks=new c.Callbacks;this.submodules={};d.extend(this,a);this._initChannel();c.Object.call(this,a)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,
arguments)},addInitializer:function(a){this._initCallbacks.add(a)},start:function(a){this.triggerMethod("before:start",a);this._initCallbacks.run(a,this);this.triggerMethod("start",a)},addRegions:function(a){return this._regionManager.addRegions(a)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(a){return this._regionManager.removeRegion(a)},getRegion:function(a){return this._regionManager.get(a)},getRegions:function(){return this._regionManager.getRegions()},
module:function(a,b){var e=c.Module.getClass(b),f=d.toArray(arguments);f.unshift(this);return e.create.apply(e,f)},getRegionManager:function(){return new c.RegionManager},_initializeRegions:function(a){var b=d.isFunction(this.regions)?this.regions(a):this.regions||{};this._initRegionManager();var e=c.getOption(a,"regions");d.isFunction(e)&&(e=e.call(this,a));d.extend(b,e);this.addRegions(b);return this},_initRegionManager:function(){this._regionManager=this.getRegionManager();this._regionManager._parent=
this;this.listenTo(this._regionManager,"before:add:region",function(){c._triggerMethod(this,"before:add:region",arguments)});this.listenTo(this._regionManager,"add:region",function(a,b){this[a]=b;c._triggerMethod(this,"add:region",arguments)});this.listenTo(this._regionManager,"before:remove:region",function(){c._triggerMethod(this,"before:remove:region",arguments)});this.listenTo(this._regionManager,"remove:region",function(a){delete this[a];c._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=
d.result(this,"channelName")||"global";this.channel=d.result(this,"channel")||f.Wreqr.radio.channel(this.channelName);this.vent=d.result(this,"vent")||this.channel.vent;this.commands=d.result(this,"commands")||this.channel.commands;this.reqres=d.result(this,"reqres")||this.channel.reqres}});c.Module=function(a,b,c){this.moduleName=a;this.options=d.extend({},this.options,c);this.initialize=c.initialize||this.initialize;this.submodules={};this._setupInitializersAndFinalizers();this.app=b;d.isFunction(this.initialize)&&
this.initialize(a,b,this.options)};c.Module.extend=c.extend;d.extend(c.Module.prototype,f.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(a){this._initializerCallbacks.add(a)},addFinalizer:function(a){this._finalizerCallbacks.add(a)},start:function(a){this._isInitialized||(d.each(this.submodules,function(b){b.startWithParent&&b.start(a)}),this.triggerMethod("before:start",a),this._initializerCallbacks.run(a,this),this._isInitialized=!0,this.triggerMethod("start",a))},stop:function(){this._isInitialized&&
(this._isInitialized=!1,this.triggerMethod("before:stop"),d.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(a,b){this._runModuleDefinition(a,b)},_runModuleDefinition:function(a,b){if(a){var e=d.flatten([this,this.app,f,c,f.$,d,b]);a.apply(this,e)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new c.Callbacks;this._finalizerCallbacks=
new c.Callbacks},triggerMethod:c.triggerMethod});d.extend(c.Module,{create:function(a,b,c){var f=a,g=d.drop(arguments,3),b=b.split("."),h=[];h[b.length-1]=c;d.each(b,function(b,d){var j=f;f=this._getModule(j,b,a,c);this._addModuleDefinition(j,f,h[d],g)},this);return f},_getModule:function(a,b,c,f){var g=d.extend({},f),f=this.getClass(f),h=a[b];h||(h=new f(b,c,g),a[b]=h,a.submodules[b]=h);return h},getClass:function(a){var b=c.Module;return!a?b:a.prototype instanceof b?a:a.moduleClass||b},_addModuleDefinition:function(a,
b,c,d){var f=this._getDefine(c),c=this._getStartWithParent(c,b);f&&b.addDefinition(f,d);this._addStartWithParent(a,b,c)},_getStartWithParent:function(a,b){var e;return d.isFunction(a)&&a.prototype instanceof c.Module?(e=b.constructor.prototype.startWithParent,d.isUndefined(e)?!0:e):d.isObject(a)?(e=a.startWithParent,d.isUndefined(e)?!0:e):!0},_getDefine:function(a){return d.isFunction(a)&&!(a.prototype instanceof c.Module)?a:d.isObject(a)?a.define:null},_addStartWithParent:function(a,b,c){b.startWithParent=
b.startWithParent&&c;b.startWithParent&&!b.startWithParentIsConfigured&&(b.startWithParentIsConfigured=!0,a.addInitializer(function(a){b.startWithParent&&b.start(a)}))}});return c});