define("confluence/page-move-dialog-browse",["jquery","ajs","confluence/templates","confluence/legacy"],function(a,g,l,q){return function(j,b,f,d,i,m){var k=a("#confluence-context-path").attr("content"),c=a(".tree",this);c.addClass("loading").html(l.MovePage.panelLoading());var e,r=function(){c.removeClass("rendering").addClass("expanding");a("#parent-selection-tree .dialog-button-panel").remove();n(g.Meta.get("space-key"),i,function(a){if(a&&""!=i){var h=e.findNodeBy("text",i);h&&h.$.find("> a").addClass("current-parent")}h=
g.Meta.get("page-title");if(a&&h&&(a=e.findNodeBy("text",h)))a.makeUnclickable(),h!=m&&a.setText(m);n(b,d,function(a){if(a&&(a=e.findNodeBy("text",d))){a.$.find("> a").addClass("highlighted");var a=a.$.position().top,o=c.height();(0>a||a>o)&&c.scrollTop(c.scrollTop()+a-o/3)}c.removeClass("expanding")})})},p=function(e){e.preventDefault();a("a.highlighted",c).removeClass("highlighted");a(this).addClass("highlighted");b=a("#chosenSpaceKey").val();f=a("#chosenSpaceKey option:selected").text();d=a(this).hasClass("root-node")?
"":a(this).find("span").text();!g.DarkFeatures.isEnabled("editor.ajax.save")||g.DarkFeatures.isEnabled("editor.ajax.save.disable")?j.select(b,f,d):0<d.length?j.select(b,f,d,a(this).parent().attr("id").split("-")[1]):j.select(b,f,d,"")},n=function(b,d,c){b!=a("#chosenSpaceKey").val()?c(!1):q.Dialogs.Breadcrumbs.defaultGetBreadcrumbs({spaceKey:b,title:d},function(b){b=b.slice(1);b[0]&&-1!==b[0].url.indexOf("collector/pages.action")&&b.shift();b=a.map(b,function(a){return{text:a.title}});e.expandPath(b,
function(){c(!0)})},function(){j.error("Could not retrieve tree expansion information.");c(!1)})};c.load(k+"/panels/browsepagelocation.action",{panelName:"browse",dialogMode:"view",spaceKey:b,parentPageString:d,pageId:g.params.pageId},function(){c.removeClass("loading").addClass("rendering");a("select#chosenSpaceKey").val(b).change(function(){var f=a(this).val(),h=a(this).find("option:selected").text();a("#tree-root-node-item a").text(h).toggleClass("highlighted",b==f&&""==d).toggleClass("current-parent",
g.Meta.get("space-key")==f&&""==i);c.addClass("rendering");e=e.reload({initUrl:k+"/pages/children.action?spaceKey="+encodeURIComponent(f)+"&node=root"})});a("#tree-root-div").html(l.MovePage.browsePanelSpace({linkText:f})).find("a").click(p).toggleClass("highlighted",""==d).toggleClass("current-parent",g.Meta.get("space-key")==b&&""==i);e=a("#parent-selection-tree").tree({url:k+"/pages/children.action",initUrl:k+"/pages/children.action?spaceKey="+encodeURIComponent(b)+"&node=root",parameters:["pageId",
"text"],undraggable:!0,spinnerId:"move-page-dialog-spinner",nodeId:"pageId",click:p,onready:r,oninsert:function(){this.$.parents("li:first").attr("unclickable")&&this.makeUnclickable()}});g.MoveDialog.tree=e})}});require("confluence/module-exporter").exportModuleAsGlobal("confluence/page-move-dialog-browse","jQuery.fn.movePageBrowse");